<UserControl x:Class="Winhance.WPF.Features.AdvancedTools.Views.WimUtilView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:viewModels="clr-namespace:Winhance.WPF.Features.AdvancedTools.ViewModels"
             xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
             d:DataContext="{d:DesignInstance Type=viewModels:WimUtilViewModel}"
             mc:Ignorable="d">

    <Grid>
        <Grid Height="80"
              VerticalAlignment="Top"
              ClipToBounds="False">
            <Viewbox Stretch="Uniform"
                     StretchDirection="DownOnly"
                     HorizontalAlignment="Left">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <iconPacks:PackIconMaterial Grid.Column="0"
                                             Kind="DiscPlayer"
                                             Width="60"
                                             Height="60"
                                             Margin="10,0,10,0"
                                             VerticalAlignment="Center"
                                             Foreground="{DynamicResource PrimaryTextColor}"/>

                    <StackPanel Grid.Column="1"
                                VerticalAlignment="Center">
                        <TextBlock Height="35"
                                   VerticalAlignment="Top"
                                   FontFamily="Helvetica Neue"
                                   FontSize="32"
                                   FontWeight="Bold"
                                   Foreground="{DynamicResource PrimaryTextColor}"
                                   Text="Windows Installation Media Utility"/>

                        <StackPanel Orientation="Horizontal"
                                    Margin="0,5,0,0">
                            <TextBlock Height="22"
                                       VerticalAlignment="Center"
                                       FontFamily="Helvetica Neue"
                                       FontSize="14"
                                       Foreground="{DynamicResource SubTextColor}"
                                       Text="Create Custom Windows Installation Media"/>
                        </StackPanel>
                    </StackPanel>
                </Grid>
            </Viewbox>
        </Grid>

        <Border Margin="0,85,0,0"
                Background="{DynamicResource MainContainerBorderBrush}"
                CornerRadius="10">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="20">

                    <!-- STEP 1: Select ISO -->
                    <ContentControl Content="{Binding Step1State}"
                                  ContentTemplate="{StaticResource WizardStepHeaderTemplate}">
                        <ContentControl.InputBindings>
                            <MouseBinding MouseAction="LeftClick"
                                        Command="{Binding NavigateToStepCommand}"
                                        CommandParameter="1"/>
                        </ContentControl.InputBindings>
                    </ContentControl>

                    <Border Background="{DynamicResource ContentSectionBorderBrush}"
                            CornerRadius="5"
                            Padding="20"
                            Margin="0,0,0,10"
                            Visibility="{Binding Step1State.IsExpanded, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <StackPanel>
                            <ContentControl Content="{Binding SelectIsoCard}"
                                          ContentTemplate="{StaticResource WizardActionCardTemplate}"/>

                            <Border Background="{DynamicResource SettingsItemBackground}"
                                    CornerRadius="4"
                                    Effect="{StaticResource UltraLightShadowEffect}"
                                    Margin="0,0,0,10"
                                    Opacity="{Binding SelectDirectoryCard.Opacity}">
                                <Grid MinHeight="50">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <iconPacks:PackIconMaterial Grid.Column="0"
                                                              Kind="FolderOpen"
                                                              Width="32"
                                                              Height="32"
                                                              Margin="15,0,15,0"
                                                              VerticalAlignment="Center"
                                                              Foreground="{DynamicResource PrimaryTextColor}"/>

                                    <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="0,10,0,10">
                                        <TextBlock Text="Select Working Directory"
                                                  FontSize="14"
                                                  FontWeight="SemiBold"
                                                  Foreground="{DynamicResource PrimaryTextColor}"/>
                                        <TextBlock Text="{Binding SelectDirectoryCard.Description}"
                                                  FontSize="12"
                                                  Foreground="{DynamicResource SecondaryTextColor}"
                                                  TextWrapping="Wrap"
                                                  Margin="0,2,0,0"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" Margin="15,0,15,0">
                                        <CheckBox Content="I have extracted ISO contents already"
                                                  IsChecked="{Binding HasExtractedIsoAlready}"
                                                  Style="{StaticResource CustomCheckBox}"
                                                  FontSize="12"
                                                  VerticalAlignment="Center"
                                                  Margin="0,0,15,0"/>

                                        <Button Content="Select Folder"
                                                Command="{Binding SelectWorkingDirectoryCommand}"
                                                IsEnabled="{Binding SelectDirectoryCard.IsEnabled}"
                                                Style="{StaticResource WizardActionButtonStyle}"
                                                Width="130"
                                                Height="30"/>
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <Button Content="Start Extraction"
                                    Command="{Binding StartIsoExtractionCommand}"
                                    IsEnabled="{Binding CanStartExtraction}"
                                    Style="{StaticResource WizardActionButtonStyle}"
                                    Width="150"
                                    HorizontalAlignment="Center"
                                    Margin="0,0,0,15"/>

                            <Border Visibility="{Binding ShowConversionCard, Converter={StaticResource BooleanToVisibilityConverter}}"
                                    Margin="0,10,0,10">
                                <StackPanel>
                                    <TextBlock Text="Optional: Convert Image Format"
                                               FontSize="13"
                                               FontWeight="SemiBold"
                                               Foreground="{DynamicResource PrimaryTextColor}"
                                               Margin="5,0,0,8"/>
                                    <ContentControl Content="{Binding ConvertImageCard}"
                                                  ContentTemplate="{StaticResource WizardActionCardTemplate}"/>
                                </StackPanel>
                            </Border>

                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,10,0,0">
                                <TextBlock Text="Download Windows ISO:"
                                           FontSize="14"
                                           Foreground="{DynamicResource SubTextColor}"
                                           VerticalAlignment="Center"
                                           Margin="0,0,10,0"/>

                                <Button Content="Windows 10"
                                        Command="{Binding OpenWindows10DownloadCommand}"
                                        Style="{StaticResource WizardActionButtonStyle}"
                                        Width="120"
                                        Height="30"
                                        Margin="0,0,10,0"/>

                                <Button Content="Windows 11"
                                        Command="{Binding OpenWindows11DownloadCommand}"
                                        Style="{StaticResource WizardActionButtonStyle}"
                                        Width="120"
                                        Height="30"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- STEP 2: Add XML File -->
                    <ContentControl Content="{Binding Step2State}"
                                  ContentTemplate="{StaticResource WizardStepHeaderTemplate}">
                        <ContentControl.InputBindings>
                            <MouseBinding MouseAction="LeftClick"
                                        Command="{Binding NavigateToStepCommand}"
                                        CommandParameter="2"/>
                        </ContentControl.InputBindings>
                    </ContentControl>

                    <Border Background="{DynamicResource ContentSectionBorderBrush}"
                            CornerRadius="5"
                            Padding="20"
                            Margin="0,0,0,10"
                            Visibility="{Binding Step2State.IsExpanded, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Grid>
                            <StackPanel IsEnabled="{Binding Step2State.IsAvailable}"
                                       Opacity="{Binding Step2State.IsAvailable, Converter={StaticResource BooleanToOpacityConverter}}">

                                <TextBlock Text="Select ONE of the following options:"
                                           FontSize="14"
                                           FontWeight="SemiBold"
                                           Foreground="{DynamicResource PrimaryTextColor}"
                                           Margin="0,0,0,15"/>

                                <Border Background="{DynamicResource SettingsItemBackground}"
                                        CornerRadius="4"
                                        Effect="{StaticResource UltraLightShadowEffect}"
                                        Margin="0,0,0,10">
                                    <Grid MinHeight="50">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <Image Grid.Column="0"
                                               Width="40"
                                               Height="40"
                                               Margin="15,0,7,0"
                                               VerticalAlignment="Center"
                                               RenderOptions.BitmapScalingMode="HighQuality">
                                            <Image.Source>
                                                <Binding Path="IsDarkTheme"
                                                         Converter="{StaticResource BooleanToThemeIconConverter}"
                                                         ConverterParameter="/Resources/AppIcons/winhance-rocket-white-transparent-bg.ico|/Resources/AppIcons/winhance-rocket-black-transparent-bg.ico"/>
                                            </Image.Source>
                                        </Image>

                                        <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="0,10,0,10">
                                            <TextBlock Text="Generate and Add Winhance XML"
                                                      FontSize="14"
                                                      FontWeight="SemiBold"
                                                      Foreground="{DynamicResource PrimaryTextColor}"/>
                                            <TextBlock Text="{Binding GenerateWinhanceXmlCard.Description}"
                                                      FontSize="12"
                                                      Foreground="{DynamicResource SecondaryTextColor}"
                                                      TextWrapping="Wrap"
                                                      Margin="0,2,0,0"/>
                                        </StackPanel>

                                        <Grid Grid.Column="2" Width="40" Height="40" Margin="0,0,0,0">
                                            <iconPacks:PackIconMaterial Kind="CheckCircle"
                                                                      Width="24"
                                                                      Height="24"
                                                                      Foreground="#4CAF50"
                                                                      VerticalAlignment="Center"
                                                                      HorizontalAlignment="Center"
                                                                      Visibility="{Binding GenerateWinhanceXmlCard.IsComplete, Converter={StaticResource BooleanToVisibilityConverter}}"/>

                                            <iconPacks:PackIconMaterial Kind="CloseCircle"
                                                                      Width="24"
                                                                      Height="24"
                                                                      Foreground="#F44336"
                                                                      VerticalAlignment="Center"
                                                                      HorizontalAlignment="Center"
                                                                      Visibility="{Binding GenerateWinhanceXmlCard.HasFailed, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                        </Grid>

                                        <Button Grid.Column="3"
                                                Content="Generate"
                                                Command="{Binding GenerateWinhanceXmlCommand}"
                                                IsEnabled="{Binding GenerateWinhanceXmlCard.IsEnabled}"
                                                Style="{StaticResource WizardActionButtonStyle}"
                                                Width="130"
                                                Height="30"
                                                Margin="15,0,15,0"/>
                                    </Grid>
                                </Border>

                                <ContentControl Content="{Binding DownloadXmlCard}"
                                              ContentTemplate="{StaticResource WizardActionCardTemplate}"/>

                                <ContentControl Content="{Binding SelectXmlCard}"
                                              ContentTemplate="{StaticResource WizardActionCardTemplate}"/>

                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,10,0,0">
                                    <TextBlock Text="Generate XML Files:"
                                               FontSize="14"
                                               Foreground="{DynamicResource SubTextColor}"
                                               VerticalAlignment="Center"
                                               Margin="0,0,10,0"/>

                                    <Button Content="Schneegans XML"
                                            Command="{Binding OpenSchneegansXmlGeneratorCommand}"
                                            Style="{StaticResource WizardActionButtonStyle}"
                                            Width="140"
                                            Height="30"/>
                                </StackPanel>
                            </StackPanel>

                            <ContentControl Content="{Binding DataContext, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                          ContentTemplate="{StaticResource LockedStepOverlayTemplate}"
                                          Visibility="{Binding Step2State.IsLocked, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                        </Grid>
                    </Border>

                    <!-- STEP 3: Add Drivers -->
                    <ContentControl Content="{Binding Step3State}"
                                  ContentTemplate="{StaticResource WizardStepHeaderTemplate}">
                        <ContentControl.InputBindings>
                            <MouseBinding MouseAction="LeftClick"
                                        Command="{Binding NavigateToStepCommand}"
                                        CommandParameter="3"/>
                        </ContentControl.InputBindings>
                    </ContentControl>

                    <Border Background="{DynamicResource ContentSectionBorderBrush}"
                            CornerRadius="5"
                            Padding="20"
                            Margin="0,0,0,10"
                            Visibility="{Binding Step3State.IsExpanded, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Grid>
                            <StackPanel IsEnabled="{Binding Step3State.IsAvailable}"
                                       Opacity="{Binding Step3State.IsAvailable, Converter={StaticResource BooleanToOpacityConverter}}">

                                <ContentControl Content="{Binding ExtractSystemDriversCard}"
                                              ContentTemplate="{StaticResource WizardActionCardTemplate}"/>

                                <ContentControl Content="{Binding SelectCustomDriversCard}"
                                              ContentTemplate="{StaticResource WizardActionCardTemplate}"/>

                            </StackPanel>

                            <ContentControl Content="{Binding DataContext, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                          ContentTemplate="{StaticResource LockedStepOverlayTemplate}"
                                          Visibility="{Binding Step3State.IsLocked, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                        </Grid>
                    </Border>

                    <!-- STEP 4: Create New ISO -->
                    <ContentControl Content="{Binding Step4State}"
                                  ContentTemplate="{StaticResource WizardStepHeaderTemplate}">
                        <ContentControl.InputBindings>
                            <MouseBinding MouseAction="LeftClick"
                                        Command="{Binding NavigateToStepCommand}"
                                        CommandParameter="4"/>
                        </ContentControl.InputBindings>
                    </ContentControl>

                    <Border Background="{DynamicResource ContentSectionBorderBrush}"
                            CornerRadius="5"
                            Padding="20"
                            Margin="0,0,0,10"
                            Visibility="{Binding Step4State.IsExpanded, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Grid>
                            <StackPanel IsEnabled="{Binding Step4State.IsAvailable}"
                                       Opacity="{Binding Step4State.IsAvailable, Converter={StaticResource BooleanToOpacityConverter}}">
                                <ContentControl Content="{Binding DownloadOscdimgCard}"
                                              ContentTemplate="{StaticResource WizardActionCardTemplate}"
                                              Visibility="{Binding IsOscdimgAvailable, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>

                                <ContentControl Content="{Binding SelectOutputCard}"
                                              ContentTemplate="{StaticResource WizardActionCardTemplate}"/>

                                <Button Content="Create ISO"
                                        Command="{Binding CreateIsoCommand}"
                                        IsEnabled="{Binding IsOscdimgAvailable}"
                                        Style="{StaticResource WizardActionButtonStyle}"
                                        Width="150"
                                        HorizontalAlignment="Center"
                                        Margin="0,0,0,15"/>
                            </StackPanel>

                            <ContentControl Content="{Binding DataContext, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                          ContentTemplate="{StaticResource LockedStepOverlayTemplate}"
                                          Visibility="{Binding Step4State.IsLocked, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                        </Grid>
                    </Border>

                </StackPanel>
            </ScrollViewer>
        </Border>
    </Grid>
</UserControl>
