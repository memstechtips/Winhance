<UserControl x:Class="Winhance.WPF.Features.SoftwareApps.Views.ExternalAppsTableView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewModels="clr-namespace:Winhance.WPF.Features.SoftwareApps.ViewModels"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:local="clr-namespace:Winhance.WPF.Features.Common.Controls"
    xmlns:controls="clr-namespace:Winhance.WPF.Features.Common.Controls"
    xmlns:behaviors="clr-namespace:Winhance.WPF.Features.Common.Behaviors" 
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    d:DataContext="{d:DesignInstance Type=viewModels:ExternalAppsViewModel}" mc:Ignorable="d">

    
    <controls:ResponsiveScrollViewer>
        <StackPanel Margin="10">

            <!-- Combined Table View for All Items -->
            <ListView x:Name="AppsListView" 
                      ItemsSource="{Binding AllItemsView}" 
                      Style="{DynamicResource ThemedListView}" 
                      ItemContainerStyle="{DynamicResource ThemedListViewItem}" 
                      Margin="10,0,10,10"
                      Width="Auto"
                      behaviors:GridViewColumnResizeBehavior.Enabled="True" 
                      behaviors:GridViewColumnResizeBehavior.Stretch="True"
                      behaviors:GridViewColumnResizeBehavior.StretchColumnIndex="-1"
                      HorizontalAlignment="Stretch" 
                      HorizontalContentAlignment="Stretch" 
                      ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                      ScrollViewer.VerticalScrollBarVisibility="Auto"
                      ScrollViewer.CanContentScroll="True"
                      VirtualizingPanel.IsVirtualizing="True"
                      VirtualizingPanel.VirtualizationMode="Recycling">
                <ListView.Template>
                    <ControlTemplate TargetType="{x:Type ListView}">
                        <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}">
                            <ScrollViewer Padding="{TemplateBinding Padding}" Style="{DynamicResource {x:Static GridView.GridViewScrollViewerStyleKey}}" HorizontalScrollBarVisibility="Disabled">
                                <ItemsPresenter SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                            </ScrollViewer>
                        </Border>
                    </ControlTemplate>
                </ListView.Template>
                <ListView.ItemsPanel>
                    <ItemsPanelTemplate>
                        <VirtualizingStackPanel />
                    </ItemsPanelTemplate>
                </ListView.ItemsPanel>
                <ListView.View>
                    <GridView x:Name="MainGridView" 
                              AllowsColumnReorder="False">
                        <!-- Force column stretching to use all available width -->
                        <GridView.ColumnHeaderContainerStyle>
                            <Style TargetType="{x:Type GridViewColumnHeader}" BasedOn="{StaticResource ThemedGridViewColumnHeader}">
                                <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                            </Style>
                        </GridView.ColumnHeaderContainerStyle>
                        <!-- Set proportional widths for columns to fill available container space -->
                        <!-- Select All Column -->
                        <GridViewColumn Width="40"><!-- Keep fixed width for checkbox column -->
                            <GridViewColumnHeader Style="{StaticResource FirstColumnHeader}">
                                <CheckBox Style="{StaticResource CustomCheckBox}" IsChecked="{Binding IsAllSelected}" VerticalAlignment="Center"/>
                            </GridViewColumnHeader>
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <CheckBox Style="{StaticResource CustomCheckBox}" IsChecked="{Binding IsSelected}" VerticalAlignment="Center"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <!-- Name Column -->
                        <GridViewColumn Width="500"><!-- Increased width substantially to fill more space -->
                            <GridViewColumnHeader Style="{StaticResource ThemedGridViewColumnHeader}" Tag="Name" Content="Name">
                                <GridViewColumnHeader.InputBindings>
                                    <MouseBinding MouseAction="LeftClick" Command="{Binding SortByCommand}" CommandParameter="Name"/>
                                </GridViewColumnHeader.InputBindings>
                            </GridViewColumnHeader>
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Name}" FontSize="18">
                                        <TextBlock.ToolTip>
                                            <ToolTip Content="{Binding Description}"/>
                                        </TextBlock.ToolTip>
                                    </TextBlock>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <!-- Package ID Column -->
                        <GridViewColumn Width="180"><!-- Slightly increased width -->
                            <GridViewColumnHeader Style="{StaticResource ThemedGridViewColumnHeader}" Tag="PackageName" Content="Package ID">
                                <GridViewColumnHeader.InputBindings>
                                    <MouseBinding MouseAction="LeftClick" Command="{Binding SortByCommand}" CommandParameter="PackageName"/>
                                </GridViewColumnHeader.InputBindings>
                            </GridViewColumnHeader>
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding PackageName}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <!-- Category Column -->
                        <GridViewColumn Width="150"><!-- Slightly increased width -->
                            <GridViewColumnHeader Style="{StaticResource ThemedGridViewColumnHeader}" Tag="Category" Content="Category">
                                <GridViewColumnHeader.InputBindings>
                                    <MouseBinding MouseAction="LeftClick" Command="{Binding SortByCommand}" CommandParameter="Category"/>
                                </GridViewColumnHeader.InputBindings>
                            </GridViewColumnHeader>
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Category}"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>

                        <!-- Source Column -->
                        <GridViewColumn Width="150"><!-- Slightly increased width -->
                            <GridViewColumnHeader Style="{StaticResource LastColumnHeader}" Tag="Source" Content="Source">
                                <GridViewColumnHeader.InputBindings>
                                    <MouseBinding MouseAction="LeftClick" Command="{Binding SortByCommand}" CommandParameter="Source"/>
                                </GridViewColumnHeader.InputBindings>
                            </GridViewColumnHeader>
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="winget/msstore"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                    </GridView>
                </ListView.View>
            </ListView>
        </StackPanel>
    </controls:ResponsiveScrollViewer>
</UserControl>
