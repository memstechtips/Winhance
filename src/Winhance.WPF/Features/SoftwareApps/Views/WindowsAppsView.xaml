<UserControl x:Class="Winhance.WPF.Features.SoftwareApps.Views.WindowsAppsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:viewModels="clr-namespace:Winhance.WPF.Features.SoftwareApps.ViewModels"
             xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
             xmlns:local="clr-namespace:Winhance.WPF.Features.Common.Controls"
             xmlns:controls="clr-namespace:Winhance.WPF.Features.Common.Controls"
             xmlns:behaviors="clr-namespace:Winhance.WPF.Features.Common.Behaviors"
             xmlns:views="clr-namespace:Winhance.WPF.Features.SoftwareApps.Views"
             d:DataContext="{d:DesignInstance Type=viewModels:WindowsAppsViewModel}"
             mc:Ignorable="d">

    <Grid>

        <views:WindowsAppsTableView
            Visibility="{Binding IsTableViewMode, Converter={StaticResource BooleanToVisibilityConverter}}"/>

        <controls:ResponsiveScrollViewer
            Visibility="{Binding IsTableViewMode, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                                        <StackPanel Margin="10">

        <!-- Checkboxes in a horizontal layout -->
        <StackPanel Orientation="Horizontal" Margin="15,10,0,10">
            <!-- Select All checkbox -->
            <CheckBox Style="{StaticResource CustomCheckBox}"
                      Content="Select All"
                      FontSize="16"
                      FontWeight="Bold"
                      IsChecked="{Binding IsAllSelected}"
                      Margin="0,0,20,0"/>

            <!-- Select All Installed checkbox -->
            <CheckBox Style="{StaticResource CustomCheckBox}"
                      Content="Select All Installed"
                      FontSize="16"
                      FontWeight="Bold"
                      IsChecked="{Binding IsAllSelectedInstalled}"
                      Margin="0,0,20,0"/>

            <!-- Select All Not Installed checkbox -->
            <CheckBox Style="{StaticResource CustomCheckBox}"
                      Content="Select All Not Installed"
                      FontSize="16"
                      FontWeight="Bold"
                      IsChecked="{Binding IsAllSelectedNotInstalled}"
                      Margin="0,0,0,0"/>
        </StackPanel>

        <!-- Windows Apps (Appx Packages) Section -->
        <StackPanel Orientation="Horizontal" Margin="0,5,0,5"
                    Visibility="{Binding HasWindowsApps, Converter={StaticResource BooleanToVisibilityConverter}}">
            <TextBlock Text="Windows Apps"
                      Style="{StaticResource SectionHeaderStyle}"/>
        </StackPanel>

        <ItemsControl ItemsSource="{Binding WindowsAppsFiltered}"
                      Visibility="{Binding HasWindowsApps, Converter={StaticResource BooleanToVisibilityConverter}}"
                      Margin="10,0,10,10">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <UniformGrid Columns="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=ItemsControl}, Converter={StaticResource WidthToColumnsConverter}}" />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <CheckBox Style="{StaticResource CustomCheckBox}"
                              Margin="5,5,5,5"
                              IsChecked="{Binding IsSelected}">
                        <StackPanel Orientation="Horizontal">
                            <Ellipse Style="{StaticResource AppStatusIndicatorStyle}"
                                     Fill="{Binding IsInstalled, Converter={StaticResource InstalledStatusToColorConverter}}">
                                <Ellipse.ToolTip>
                                    <ToolTip Content="{Binding IsInstalled, Converter={StaticResource InstalledStatusToTextConverter}}"/>
                                </Ellipse.ToolTip>
                            </Ellipse>

                            <!-- Reinstallability indicator -->
                            <iconPacks:PackIconMaterial
                                Style="{StaticResource ReinstallabilityIndicatorStyle}"
                                Kind="{Binding CanBeReinstalled, Converter={StaticResource BooleanToReinstallableIconConverter}}"
                                Foreground="{Binding CanBeReinstalled, Converter={StaticResource BooleanToReinstallableColorConverter}}">
                                <iconPacks:PackIconMaterial.ToolTip>
                                    <ToolTip Content="{Binding CanBeReinstalled, Converter={StaticResource BooleanToReinstallableTextConverter}}"/>
                                </iconPacks:PackIconMaterial.ToolTip>
                            </iconPacks:PackIconMaterial>

                            <TextBlock Text="{Binding Name}"
                                       Style="{StaticResource AppItemTextStyle}">
                                <TextBlock.ToolTip>
                                    <ToolTip Content="{Binding Description}"/>
                                </TextBlock.ToolTip>
                            </TextBlock>

                        </StackPanel>
                    </CheckBox>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!-- Separator -->
        <Separator Style="{StaticResource SectionSeparatorStyle}"
                   Visibility="{Binding HasWindowsApps, Converter={StaticResource BooleanToVisibilityConverter}}"/>

        <!-- Capabilities Section -->
        <StackPanel Orientation="Horizontal" Margin="0,5,0,5"
                    Visibility="{Binding HasCapabilities, Converter={StaticResource BooleanToVisibilityConverter}}">
            <TextBlock Text="Windows Capabilities"
                      Style="{StaticResource SectionHeaderStyle}"/>
        </StackPanel>

        <ItemsControl ItemsSource="{Binding CapabilitiesFiltered}"
                      Visibility="{Binding HasCapabilities, Converter={StaticResource BooleanToVisibilityConverter}}"
                      Margin="10,0,10,10">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <UniformGrid Columns="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=ItemsControl}, Converter={StaticResource WidthToColumnsConverter}}" />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <CheckBox Style="{StaticResource CustomCheckBox}"
                              Margin="5,5,5,5"
                              IsChecked="{Binding IsSelected}">
                        <StackPanel Orientation="Horizontal">
                            <Ellipse Style="{StaticResource AppStatusIndicatorStyle}"
                                     Fill="{Binding IsInstalled, Converter={StaticResource InstalledStatusToColorConverter}}">
                                <Ellipse.ToolTip>
                                    <ToolTip Content="{Binding IsInstalled, Converter={StaticResource InstalledStatusToTextConverter}}"/>
                                </Ellipse.ToolTip>
                            </Ellipse>

                            <!-- Reinstallability indicator -->
                            <iconPacks:PackIconMaterial
                                Style="{StaticResource ReinstallabilityIndicatorStyle}"
                                Kind="{Binding CanBeReinstalled, Converter={StaticResource BooleanToReinstallableIconConverter}}"
                                Foreground="{Binding CanBeReinstalled, Converter={StaticResource BooleanToReinstallableColorConverter}}">
                                <iconPacks:PackIconMaterial.ToolTip>
                                    <ToolTip Content="{Binding CanBeReinstalled, Converter={StaticResource BooleanToReinstallableTextConverter}}"/>
                                </iconPacks:PackIconMaterial.ToolTip>
                            </iconPacks:PackIconMaterial>

                            <TextBlock Text="{Binding Name}"
                                       Style="{StaticResource AppItemTextStyle}">
                                <TextBlock.ToolTip>
                                    <ToolTip Content="{Binding Description}"/>
                                </TextBlock.ToolTip>
                            </TextBlock>

                        </StackPanel>
                    </CheckBox>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        <!-- Separator -->
        <Separator Style="{StaticResource SectionSeparatorStyle}"
                   Visibility="{Binding HasCapabilities, Converter={StaticResource BooleanToVisibilityConverter}}"/>

        <!-- Optional Features Section -->
        <StackPanel Orientation="Horizontal" Margin="0,5,0,5"
                    Visibility="{Binding HasOptionalFeatures, Converter={StaticResource BooleanToVisibilityConverter}}">
            <TextBlock Text="Windows Optional Features"
                      Style="{StaticResource SectionHeaderStyle}"/>
        </StackPanel>

        <ItemsControl ItemsSource="{Binding OptionalFeaturesFiltered}"
                      Visibility="{Binding HasOptionalFeatures, Converter={StaticResource BooleanToVisibilityConverter}}"
                      Margin="10,0,10,10">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <UniformGrid Columns="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=ItemsControl}, Converter={StaticResource WidthToColumnsConverter}}" />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <CheckBox Style="{StaticResource CustomCheckBox}"
                              Margin="5,5,5,5"
                              IsChecked="{Binding IsSelected}">
                        <StackPanel Orientation="Horizontal">
                            <Ellipse Style="{StaticResource AppStatusIndicatorStyle}"
                                     Fill="{Binding IsInstalled, Converter={StaticResource InstalledStatusToColorConverter}}">
                                <Ellipse.ToolTip>
                                    <ToolTip Content="{Binding IsInstalled, Converter={StaticResource InstalledStatusToTextConverter}}"/>
                                </Ellipse.ToolTip>
                            </Ellipse>

                            <!-- Reinstallability indicator -->
                            <iconPacks:PackIconMaterial
                                Style="{StaticResource ReinstallabilityIndicatorStyle}"
                                Kind="{Binding CanBeReinstalled, Converter={StaticResource BooleanToReinstallableIconConverter}}"
                                Foreground="{Binding CanBeReinstalled, Converter={StaticResource BooleanToReinstallableColorConverter}}">
                                <iconPacks:PackIconMaterial.ToolTip>
                                    <ToolTip Content="{Binding CanBeReinstalled, Converter={StaticResource BooleanToReinstallableTextConverter}}"/>
                                </iconPacks:PackIconMaterial.ToolTip>
                            </iconPacks:PackIconMaterial>

                            <TextBlock Text="{Binding Name}"
                                       Style="{StaticResource AppItemTextStyle}">
                                <TextBlock.ToolTip>
                                    <ToolTip Content="{Binding Description}"/>
                                </TextBlock.ToolTip>
                            </TextBlock>

                            </StackPanel>
                    </CheckBox>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        </StackPanel>
        </controls:ResponsiveScrollViewer>
    </Grid>
</UserControl>
