<UserControl x:Class="Winhance.WPF.Features.Common.Controls.SearchBox"
             x:ClassModifier="public"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
             xmlns:loc="clr-namespace:Winhance.WPF.Features.Common.Extensions"
             mc:Ignorable="d"
             d:DesignHeight="36" d:DesignWidth="200">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>
        
        <!-- Search Icon -->
        <iconPacks:PackIconMaterial Grid.Column="0" 
                                 Kind="Magnify"
                                 Height="16"
                                 Width="16" 
                                 Style="{StaticResource MaterialIconStyle}"
                                 Margin="5,0,5,0"
                                 VerticalAlignment="Center"/>
        
        <!-- Search TextBox with Placeholder -->
        <Grid Grid.Column="1">
            <TextBlock Text="{loc:Localize Common_Search_Placeholder}"
                       Foreground="{DynamicResource SecondaryTextColor}"
                       VerticalAlignment="Center"
                       Margin="10,0,2,0"
                       IsHitTestVisible="False">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Setter Property="Visibility" Value="Collapsed"/>
                        <Style.Triggers>
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding ElementName=SearchTextBox, Path=IsFocused}" Value="False"/>
                                    <Condition Binding="{Binding ElementName=SearchTextBox, Path=Text.Length}" Value="0"/>
                                </MultiDataTrigger.Conditions>
                                <Setter Property="Visibility" Value="Visible"/>
                            </MultiDataTrigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>
            <TextBox x:Name="SearchTextBox"
                     Text="{Binding SearchText, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged}"
                     Foreground="{DynamicResource PrimaryTextColor}"
                     Background="Transparent"
                     BorderBrush="{DynamicResource ButtonBorderBrush}"
                     CaretBrush="{DynamicResource PrimaryTextColor}"
                     VerticalAlignment="Center"
                     Height="30"
                     Padding="5,0,2,0"
                     LostFocus="SearchTextBox_LostFocus"
                     Style="{StaticResource RoundedTextBoxStyle}"/>
        </Grid>
        
        <!-- Clear Button (visible when focused) -->
        <Button Grid.Column="2"
                Width="24" Height="24"
                Padding="0"
                Margin="2,0,2,0"
                Focusable="False"
                Click="ClearButton_Click">
            <Button.Style>
                <Style TargetType="Button" BasedOn="{StaticResource SearchClearButtonStyle}">
                    <Setter Property="Visibility" Value="Collapsed"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding ElementName=SearchTextBox, Path=IsFocused}" Value="True">
                            <Setter Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Button.Style>
            <iconPacks:PackIconMaterial Kind="Close"
                                     Width="12"
                                     Height="12"
                                     Foreground="{DynamicResource SecondaryTextColor}"/>
        </Button>
    </Grid>
</UserControl>
