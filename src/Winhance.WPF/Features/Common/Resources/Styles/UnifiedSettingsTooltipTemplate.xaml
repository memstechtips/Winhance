<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:Winhance.WPF.Features.Common.Converters"
    xmlns:oldConverters="clr-namespace:Winhance.WPF.Converters">

    <converters:CountToVisibilityConverter x:Key="CountToVisibilityConverter"/>
    <converters:InverseCountToVisibilityConverter x:Key="InverseCountToVisibilityConverter"/>
    <oldConverters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    <converters:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter"/>
    <converters:InverseNullToVisibilityConverter x:Key="InverseNullToVisibilityConverter"/>

    <!-- Registry Settings Section Template -->
    <DataTemplate x:Key="RegistrySettingsSection">
        <StackPanel Visibility="{Binding IndividualRegistryValues.Count, Converter={StaticResource CountToVisibilityConverter}}">
            <StackPanel x:Name="MultipleRegistryDisplay">
                <StackPanel.Style>
                    <Style TargetType="StackPanel">
                        <Setter Property="Visibility" Value="Collapsed"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IndividualRegistryValues.Count}" Value="1">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                            <DataTrigger>
                                <DataTrigger.Binding>
                                    <Binding Path="IndividualRegistryValues.Count">
                                        <Binding.Converter>
                                            <converters:CountToVisibilityConverter/>
                                        </Binding.Converter>
                                    </Binding>
                                </DataTrigger.Binding>
                                <DataTrigger.Value>
                                    <Visibility>Visible</Visibility>
                                </DataTrigger.Value>
                                <Setter Property="Visibility" Value="Visible"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </StackPanel.Style>

                <ItemsControl ItemsSource="{Binding IndividualRegistryValues}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border BorderBrush="{DynamicResource TooltipBorderBrush}" BorderThickness="1" Padding="4" CornerRadius="3" Background="{DynamicResource SettingsItemBackground}">
                                <StackPanel>
                                    <TextBlock FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryTextColor}">
                                        <Run Text="Registry Path: "/>
                                        <Run Text="{Binding Key.KeyPath, Mode=OneWay, TargetNullValue='null'}"/>
                                    </TextBlock>
                                    <TextBlock FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryTextColor}">
                                        <Run Text="Value Name: "/>
                                        <Run Text="{Binding Key.ValueName, Mode=OneWay, TargetNullValue='(no name)'}"/>
                                    </TextBlock>
                                    <TextBlock FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryTextColor}">
                                        <Run Text="Value Type: "/>
                                        <Run Text="{Binding Key.ValueType, Mode=OneWay, TargetNullValue='(type unknown)'}"/>
                                    </TextBlock>
                                    <TextBlock FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryTextColor}">
                                        <Run Text="Current Value: "/>
                                        <Run Text="{Binding Value, Mode=OneWay, TargetNullValue='(not set)'}"/>
                                    </TextBlock>
                                    <TextBlock FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryTextColor}">
                                        <Run Text="Recommended: "/>
                                        <Run Text="{Binding Key.RecommendedValue, Mode=OneWay, TargetNullValue='null'}"/>
                                    </TextBlock>
                                    <TextBlock FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryTextColor}" Visibility="{Binding Key.EnabledValue, Converter={StaticResource InverseNullToVisibilityConverter}}">
                                        <Run Text="Enabled: "/>
                                        <Run Text="{Binding Key.EnabledValue, Mode=OneWay, TargetNullValue='null'}"/>
                                    </TextBlock>
                                    <TextBlock FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryTextColor}" Visibility="{Binding Key.DisabledValue, Converter={StaticResource InverseNullToVisibilityConverter}}">
                                        <Run Text="Disabled: "/>
                                        <Run Text="{Binding Key.DisabledValue, Mode=OneWay, TargetNullValue='null'}"/>
                                    </TextBlock>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
        </StackPanel>
    </DataTemplate>

    <!-- Command Settings Section Template -->
    <DataTemplate x:Key="CommandSettingsSection">
        <StackPanel Visibility="{Binding CommandSettings.Count, Converter={StaticResource CountToVisibilityConverter}}">
            <ItemsControl ItemsSource="{Binding CommandSettings}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="{DynamicResource TooltipBorderBrush}" BorderThickness="1" Padding="8" Margin="0,2" CornerRadius="3" Background="{DynamicResource SettingsItemBackground}">
                            <StackPanel>
                                <TextBlock FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryTextColor}">
                                    <Run Text="Command ID: "/>
                                    <Run Text="{Binding Id, Mode=OneWay, TargetNullValue='(no id)'}"/>
                                </TextBlock>
                                <TextBlock FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryTextColor}">
                                    <Run Text="Enabled Command: "/>
                                    <Run Text="{Binding EnabledCommand, Mode=OneWay, TargetNullValue='(not set)'}"/>
                                </TextBlock>
                                <TextBlock FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryTextColor}">
                                    <Run Text="Disabled Command: "/>
                                    <Run Text="{Binding DisabledCommand, Mode=OneWay, TargetNullValue='(not set)'}"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </StackPanel>
    </DataTemplate>

    <!-- PowerCfg Settings Section Template -->
    <DataTemplate x:Key="PowerCfgSettingsSection">
        <StackPanel Visibility="{Binding PowerCfgSettings.Count, Converter={StaticResource CountToVisibilityConverter}}">
            <ItemsControl ItemsSource="{Binding PowerCfgSettings}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="{DynamicResource TooltipBorderBrush}" BorderThickness="1" Padding="8" Margin="0,2" CornerRadius="3" Background="{DynamicResource SettingsItemBackground}">
                            <StackPanel>
                                <TextBlock FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryTextColor}" Visibility="{Binding SubgroupGUIDAlias, Converter={StaticResource InverseNullToVisibilityConverter}}">
                                    <Run Text="Subgroup GUID Alias: "/>
                                    <Run Text="{Binding SubgroupGUIDAlias, Mode=OneWay}"/>
                                </TextBlock>
                                <TextBlock FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryTextColor}" Visibility="{Binding SettingGUIDAlias, Converter={StaticResource InverseNullToVisibilityConverter}}">
                                    <Run Text="Setting GUID Alias: "/>
                                    <Run Text="{Binding SettingGUIDAlias, Mode=OneWay}"/>
                                </TextBlock>
                                <TextBlock FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryTextColor}">
                                    <Run Text="Subgroup GUID: "/>
                                    <Run Text="{Binding SubgroupGuid, Mode=OneWay, TargetNullValue='(not set)'}"/>
                                </TextBlock>
                                <TextBlock FontSize="10" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryTextColor}">
                                    <Run Text="Setting GUID: "/>
                                    <Run Text="{Binding SettingGuid, Mode=OneWay, TargetNullValue='(not set)'}"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </StackPanel>
    </DataTemplate>

    <!-- Unified Settings Tooltip Template -->
    <DataTemplate x:Key="UnifiedSettingsTooltipTemplate">
        <StackPanel>
            <ContentPresenter Content="{Binding}" ContentTemplate="{StaticResource RegistrySettingsSection}"/>
            
            <ContentPresenter Content="{Binding}" ContentTemplate="{StaticResource CommandSettingsSection}" 
                            Margin="0,5,0,0"/>
            
            <ContentPresenter Content="{Binding}" ContentTemplate="{StaticResource PowerCfgSettingsSection}" 
                            Margin="0,5,0,0"/>
        </StackPanel>
    </DataTemplate>

</ResourceDictionary>