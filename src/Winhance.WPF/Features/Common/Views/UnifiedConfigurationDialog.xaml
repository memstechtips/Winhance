<Window x:Class="Winhance.WPF.Features.Common.Views.UnifiedConfigurationDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Winhance.WPF.Features.Common.Views"
        xmlns:controls="clr-namespace:Winhance.WPF.Features.Common.Controls"
        xmlns:converters="clr-namespace:Winhance.WPF.Features.Common.Converters"
        xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
        mc:Ignorable="d"
        Title="{Binding Title}"
        Width="1000"
        Height="700"
        MinWidth="800"
        MinHeight="600"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        ShowInTaskbar="False"
        Background="Transparent"
        Foreground="{DynamicResource PrimaryTextColor}"
        WindowStyle="None"
        AllowsTransparency="True">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Features/Common/Resources/Converters/Converters.xaml"/>
                <ResourceDictionary Source="/Features/Common/Resources/Styles/RadioButtonStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <converters:GreaterThanZeroConverter x:Key="GreaterThanZeroConverter" />
            <converters:ItemCountConverter x:Key="ItemCountConverter" />
            <converters:SectionIconConverter x:Key="SectionIconConverter" />
        </ResourceDictionary>
    </Window.Resources>

    <Grid>
        <Grid.OpacityMask>
            <VisualBrush>
                <VisualBrush.Visual>
                    <Border Background="Black"
                            CornerRadius="10"
                            Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Grid}}"
                            Height="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType=Grid}}"/>
                </VisualBrush.Visual>
            </VisualBrush>
        </Grid.OpacityMask>

        <Border CornerRadius="10"
                BorderBrush="Transparent"
                Background="{DynamicResource WindowBackground}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header with Title and Close Button -->
                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="{Binding Title}"
                               Grid.Column="0"
                               VerticalAlignment="Center"
                               Margin="15,5,5,15"
                               FontWeight="SemiBold"
                               FontSize="16"
                               Foreground="{DynamicResource PrimaryTextColor}"/>

                    <Button Grid.Column="1"
                            Style="{StaticResource WindowCloseButton}"
                            Click="CloseButton_Click"
                            Width="32"
                            Height="32"
                            Margin="0,0,0,0"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top">
                        <iconPacks:PackIconMaterial Kind="Close"
                                                     Width="12"
                                                     Height="12"/>
                    </Button>
                </Grid>
            
            <!-- Dialog Content -->
            <Grid Grid.Row="1" Margin="20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Header with Icon -->
                <DockPanel Grid.Row="0" Margin="0,-30,0,15" Style="{StaticResource DialogHeaderStyle}">
                    <iconPacks:PackIconMaterial Kind="FileImport"
                                                Width="32"
                                                Height="32"
                                                Margin="0,0,10,0"
                                                VerticalAlignment="Top"
                                                Foreground="{DynamicResource PrimaryTextColor}"
                                                DockPanel.Dock="Left"/>
                    <TextBlock Text="{Binding Description}"
                               FontWeight="Medium"
                               FontSize="16"
                               TextWrapping="Wrap"
                               Style="{StaticResource DialogTextBlockStyle}"/>
                </DockPanel>

                <!-- Section Selector -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
            
            <!-- Sections List -->
            <Border Background="{DynamicResource ContentSectionBorderBrush}"
                    BorderBrush="Transparent"
                    CornerRadius="8"
                    Padding="12"
                    Effect="{StaticResource LightShadowEffect}">
                <ScrollViewer Grid.Column="0"
                              Style="{StaticResource ModernScrollViewer}"
                              VerticalScrollBarVisibility="Auto"
                              Margin="0,5">
                    <ItemsControl ItemsSource="{Binding Sections}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Margin="0,10">
                                <!-- Parent Section -->
                                <Grid>
                                    <Grid.Style>
                                        <Style TargetType="Grid">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsAvailable}" Value="False">
                                                    <Setter Property="Opacity" Value="0.4"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Grid.Style>

                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Parent Checkbox -->
                                    <CheckBox Grid.Column="0"
                                              Style="{StaticResource CustomCheckBox}"
                                              IsChecked="{Binding IsSelected}"
                                              VerticalAlignment="Center"
                                              IsEnabled="{Binding IsAvailable}"/>

                                    <!-- Parent Icon -->
                                    <iconPacks:PackIconMaterial Grid.Column="1"
                                                                Kind="{Binding Name, Converter={StaticResource SectionIconConverter}}"
                                                                Width="20"
                                                                Height="20"
                                                                Margin="0,0,5,0"
                                                                VerticalAlignment="Center"
                                                                Foreground="{DynamicResource PrimaryTextColor}"/>

                                    <!-- Section Info -->
                                    <StackPanel Grid.Column="2"
                                                Margin="0,0,0,0">
                                        <TextBlock Text="{Binding Name}"
                                                   FontWeight="SemiBold"
                                                   FontSize="18"
                                                   Foreground="{DynamicResource PrimaryTextColor}"/>

                                        <!-- Availability Indicator -->
                                        <TextBlock Text="No items found to import from this config file"
                                                   Foreground="#E74C3C"
                                                   FontSize="11"
                                                   FontStyle="Italic"
                                                   Margin="0,4,0,0">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsAvailable}" Value="False">
                                                            <Setter Property="Visibility" Value="Visible"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </StackPanel>
                                </Grid>
                                
                                <!-- Child Sections -->
                                <ItemsControl ItemsSource="{Binding SubSections}"
                                              Visibility="{Binding HasSubSections, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Margin="30,6,0,0">
                                                <StackPanel.Style>
                                                    <Style TargetType="StackPanel">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding IsAvailable}" Value="False">
                                                                <Setter Property="Opacity" Value="0.4"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </StackPanel.Style>

                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <CheckBox Grid.Column="0"
                                                              Margin="-5,0,0,0"
                                                              Style="{StaticResource CustomCheckBox}"
                                                              IsChecked="{Binding IsSelected}"
                                                              VerticalAlignment="Center"
                                                              IsEnabled="{Binding IsAvailable}"/>

                                                    <!-- Sub-Section Icon -->
                                                    <iconPacks:PackIconMaterial Grid.Column="1"
                                                                                Kind="{Binding Name, Converter={StaticResource SectionIconConverter}}"
                                                                                Width="18"
                                                                                Height="18"
                                                                                Margin="0,0,5,0"
                                                                                VerticalAlignment="Center"
                                                                                Foreground="{DynamicResource SecondaryTextColor}"/>

                                                    <StackPanel Grid.Column="2"
                                                                Margin="0,0,0,0"
                                                                VerticalAlignment="Center">
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="{Binding Name}"
                                                                       FontSize="14.5"
                                                                       VerticalAlignment="Center"
                                                                       Foreground="{DynamicResource PrimaryTextColor}"/>
                                                            <TextBlock Text="{Binding ItemCount, Converter={StaticResource ItemCountConverter}}"
                                                                       Foreground="{DynamicResource TertiaryTextColor}"
                                                                       FontSize="11"
                                                                       Margin="6,0,0,0"
                                                                       VerticalAlignment="Center"/>
                                                        </StackPanel>

                                                        <TextBlock Text="No items found to import from this config file"
                                                                   Foreground="#E74C3C"
                                                                   FontSize="11"
                                                                   FontStyle="Italic"
                                                                   Margin="0,2,0,0">
                                                            <TextBlock.Style>
                                                                <Style TargetType="TextBlock">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding IsAvailable}" Value="False">
                                                                            <Setter Property="Visibility" Value="Visible"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>
                                                    </StackPanel>
                                                </Grid>

                                                <ItemsControl ItemsSource="{Binding ActionOptions}"
                                                              Margin="30,4,0,0"
                                                              Visibility="{Binding HasActionOptions, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Grid Margin="0,2">
                                                                <RadioButton Content="{Binding Label}"
                                                                             Margin="-10,0,0,0"
                                                                             IsChecked="{Binding IsSelected}"
                                                                             GroupName="{Binding GroupName}"
                                                                             Style="{StaticResource CustomRadioButton}"
                                                                             Foreground="{DynamicResource SecondaryTextColor}"
                                                                             FontSize="13"
                                                                             Visibility="{Binding Path=IsRadioButton, Converter={StaticResource BooleanToVisibilityConverter}}"/>

                                                                <CheckBox Content="{Binding Label}"
                                                                          Margin="-8,0,0,0"
                                                                          IsChecked="{Binding IsSelected}"
                                                                          Style="{StaticResource SmallCheckBox}"
                                                                          Foreground="{DynamicResource SecondaryTextColor}"
                                                                          FontSize="13"
                                                                          Visibility="{Binding Path=IsRadioButton, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                                                            </Grid>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
                    </Border>
                </Grid>
        
                <!-- Buttons -->
                <StackPanel Grid.Row="2"
                            Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            Margin="0,15,0,0">
                    <Button Content="Cancel"
                            Style="{StaticResource DialogButtonStyle}"
                            Margin="0,0,10,0"
                            Command="{Binding CancelCommand}"/>
                    <Button Content="OK"
                            Style="{StaticResource DialogButtonStyle}"
                            Command="{Binding OkCommand}"
                            IsDefault="True"/>
                </StackPanel>
            </Grid>
        </Grid>
    </Border>
    </Grid>
</Window>