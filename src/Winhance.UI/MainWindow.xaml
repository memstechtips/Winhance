<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="Winhance.UI.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Winhance.UI"
    xmlns:controls="using:Winhance.UI.Features.Common.Controls"
    Title="Winhance">

    <Grid x:Name="RootGrid" Loaded="RootGrid_Loaded">
        <Grid.RowDefinitions>
            <RowDefinition Height="48"/>    <!-- TitleBar -->
            <RowDefinition Height="Auto"/>  <!-- Update InfoBar -->
            <RowDefinition Height="Auto"/>  <!-- Review Mode Bar -->
            <RowDefinition Height="*"/>     <!-- Main Content -->
        </Grid.RowDefinitions>

        <!-- Title Bar Area -->
        <Grid x:Name="AppTitleBar" Height="48" Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition x:Name="LeftPaddingColumn" Width="0"/>
                <ColumnDefinition x:Name="ToggleColumn" Width="Auto"/>
                <ColumnDefinition x:Name="IconColumn" Width="Auto"/>
                <ColumnDefinition x:Name="TitleColumn" Width="Auto"/>
                <ColumnDefinition x:Name="DragColumn" Width="*"/>
                <ColumnDefinition x:Name="ButtonsColumn" Width="Auto"/>
                <ColumnDefinition x:Name="RightPaddingColumn" Width="0"/>
            </Grid.ColumnDefinitions>

            <!-- Navigation Toggle Button (Hamburger) -->
            <Button x:Name="PaneToggleButton"
                    Grid.Column="1"
                    Click="PaneToggleButton_Click"
                    Style="{StaticResource TitleBarButtonStyle}"
                    ToolTipService.ToolTip="Toggle Navigation"
                    Margin="4,0,0,0">
                <FontIcon Glyph="&#xE700;" FontSize="16"/>
            </Button>

            <!-- App Icon -->
            <Image x:Name="AppIcon"
                   Grid.Column="2"
                   Width="20" Height="20"
                   Margin="8,0,8,0"
                   VerticalAlignment="Center"/>

            <!-- App Title and Subtitle -->
            <StackPanel Grid.Column="3"
                        Orientation="Horizontal"
                        VerticalAlignment="Center"
                        Spacing="6">
                <TextBlock x:Name="AppTitleTextBlock"
                           Text="Winhance"
                           FontSize="12"
                           FontWeight="SemiBold"
                           VerticalAlignment="Center"/>
                <TextBlock x:Name="AppSubtitleTextBlock"
                           Text="by Memory"
                           FontSize="11"
                           Opacity="0.6"
                           VerticalAlignment="Center"/>
            </StackPanel>

            <!-- Title Bar Action Buttons -->
            <StackPanel x:Name="TitleBarButtons"
                        Grid.Column="5"
                        Orientation="Horizontal"
                        VerticalAlignment="Center"
                        Margin="0,0,8,0"
                        Spacing="2">

                <!-- Save Configuration Button -->
                <Button x:Name="SaveConfigButton"
                        Style="{StaticResource TitleBarButtonStyle}"
                        ToolTipService.ToolTip="Save Configuration">
                    <FontIcon Glyph="&#xE74E;" FontSize="14"/>
                </Button>

                <!-- Import Configuration Button -->
                <Button x:Name="ImportConfigButton"
                        Style="{StaticResource TitleBarButtonStyle}"
                        ToolTipService.ToolTip="Import Configuration">
                    <FontIcon Glyph="&#xE8B7;" FontSize="14"/>
                </Button>

                <!-- Windows Version Filter Button -->
                <Button x:Name="WindowsFilterButton"
                        Style="{StaticResource TitleBarButtonStyle}"
                        ToolTipService.ToolTip="Windows Version Filter">
                    <Viewbox Width="14" Height="14">
                        <PathIcon x:Name="WindowsFilterIcon" Data="{StaticResource FilterCheckIconPath}" Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                    </Viewbox>
                </Button>

                <!-- Donate Button -->
                <Button x:Name="DonateButton"
                        Style="{StaticResource TitleBarButtonStyle}"
                        ToolTipService.ToolTip="Donate">
                    <FontIcon Glyph="&#xE00B;" FontSize="14" Foreground="#FFE74C3C"/>
                </Button>

                <!-- Bug Report Button -->
                <Button x:Name="BugReportButton"
                        Style="{StaticResource TitleBarButtonStyle}"
                        ToolTipService.ToolTip="Report a Bug">
                    <FontIcon Glyph="&#xEBE8;" FontSize="14"/>
                </Button>

                <!-- Documentation Button -->
                <Button x:Name="DocsButton"
                        Style="{StaticResource TitleBarButtonStyle}"
                        ToolTipService.ToolTip="Documentation">
                    <Viewbox Width="14" Height="14">
                        <PathIcon Data="{StaticResource BookOpenVariantOutlineIconPath}" Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                    </Viewbox>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Update InfoBar -->
        <InfoBar x:Name="UpdateInfoBar"
                 Grid.Row="1"
                 IsClosable="True"
                 Closed="UpdateInfoBar_Closed"/>

        <!-- Review Mode Bar (visible during config review) -->
        <Grid x:Name="ReviewModeBar"
              Grid.Row="2"
              Background="{ThemeResource AccentFillColorDefaultBrush}"
              Visibility="Collapsed"
              Padding="16,10,16,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>  <!-- Icon -->
                <ColumnDefinition Width="Auto"/>  <!-- Title -->
                <ColumnDefinition Width="Auto"/>  <!-- Description -->
                <ColumnDefinition Width="*"/>     <!-- Status text -->
                <ColumnDefinition Width="Auto"/>  <!-- Apply button -->
                <ColumnDefinition Width="Auto"/>  <!-- Cancel button -->
            </Grid.ColumnDefinitions>

            <FontIcon Grid.Column="0"
                      Glyph="&#xE7BE;"
                      FontSize="16"
                      Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}"
                      VerticalAlignment="Center"
                      Margin="0,0,10,0"/>

            <TextBlock Grid.Column="1"
                       x:Name="ReviewModeTitleText"
                       Text="Config Review Mode"
                       FontWeight="SemiBold"
                       FontSize="13"
                       Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}"
                       VerticalAlignment="Center"
                       Margin="0,0,12,0"/>

            <TextBlock Grid.Column="2"
                       x:Name="ReviewModeDescriptionText"
                       FontSize="12"
                       Foreground="{ThemeResource TextOnAccentFillColorSecondaryBrush}"
                       VerticalAlignment="Center"
                       Opacity="0.85"
                       Margin="0,0,16,0"/>

            <TextBlock Grid.Column="3"
                       x:Name="ReviewModeStatusText"
                       FontSize="12"
                       Foreground="{ThemeResource TextOnAccentFillColorSecondaryBrush}"
                       VerticalAlignment="Center"
                       Opacity="0.9"/>

            <Button Grid.Column="4"
                    x:Name="ReviewModeApplyButton"
                    Click="ReviewModeApplyButton_Click"
                    Background="#40FFFFFF"
                    Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}"
                    BorderThickness="0"
                    VerticalAlignment="Center"
                    Margin="8,0,4,0">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon Glyph="&#xE73E;" FontSize="14"/>
                    <TextBlock x:Name="ReviewModeApplyButtonText" Text="Apply Config"/>
                </StackPanel>
            </Button>

            <Button Grid.Column="5"
                    x:Name="ReviewModeCancelButton"
                    Click="ReviewModeCancelButton_Click"
                    Background="#40FFFFFF"
                    Foreground="{ThemeResource TextOnAccentFillColorPrimaryBrush}"
                    BorderThickness="0"
                    ToolTipService.ToolTip="Cancel review"
                    VerticalAlignment="Center"
                    Margin="4,0,0,0">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon Glyph="&#xE711;" FontSize="14"/>
                    <TextBlock x:Name="ReviewModeCancelButtonText" Text="Cancel"/>
                </StackPanel>
            </Button>
        </Grid>

        <!-- Main Content Area -->
        <Grid Grid.Row="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>  <!-- NavSidebar -->
                <ColumnDefinition Width="*"/>     <!-- Content -->
            </Grid.ColumnDefinitions>

            <!-- Custom Navigation Sidebar -->
            <controls:NavSidebar x:Name="NavSidebar"
                                 Grid.Column="0"
                                 ItemClicked="NavSidebar_ItemClicked"/>

            <!-- Content + Task Progress -->
            <Grid Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Content Frame for Page Navigation -->
                <Frame x:Name="ContentFrame" Grid.Row="0"/>

                <!-- Task Progress Bar -->
                <controls:TaskProgressControl x:Name="TaskProgressControl"
                                               Grid.Row="1"
                                               Margin="0,2,12,8"/>
            </Grid>
        </Grid>

        <!-- Loading Overlay (shown during startup initialization) -->
        <Grid x:Name="LoadingOverlay"
              Grid.RowSpan="4"
              Background="{ThemeResource SolidBackgroundFillColorBaseBrush}"
              Visibility="Visible">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="24">
                <!-- Logo + Branding -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="16">
                    <Image x:Name="LoadingLogo" Width="128" Height="128" VerticalAlignment="Center"/>
                    <StackPanel VerticalAlignment="Center" Spacing="-4">
                        <TextBlock x:Name="LoadingTitleText"
                                   FontSize="80"
                                   FontWeight="Bold"/>
                        <TextBlock x:Name="LoadingTaglineText"
                                   FontSize="16"
                                   Opacity="0.7"/>
                    </StackPanel>
                </StackPanel>

                <!-- Status + Spinner -->
                <StackPanel HorizontalAlignment="Center" Spacing="16">
                    <TextBlock x:Name="LoadingStatusText"
                               HorizontalAlignment="Center"
                               FontSize="14"
                               Opacity="0.6"/>
                    <ProgressRing IsActive="True" Width="40" Height="40"/>
                </StackPanel>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
