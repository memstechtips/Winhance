<?xml version="1.0" encoding="utf-8"?>
<ResourceDictionary
    x:Class="Winhance.UI.Features.Common.Resources.SettingTemplates"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:viewModels="using:Winhance.UI.Features.Optimize.ViewModels"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:commonControls="using:Winhance.UI.Features.Common.Controls">

    <!-- Common spacing for settings cards -->
    <x:Double x:Key="SettingsCardSpacing">4</x:Double>

    <!-- Common layout values for settings pages -->
    <x:Double x:Key="SettingsContentMaxWidth">1000</x:Double>
    <Thickness x:Key="SettingsContentMargin">24,0,24,0</Thickness>

    <!-- SettingsCard internal spacing overrides for tighter layout -->
    <!-- Reduce padding around the icon area -->
    <Thickness x:Key="SettingsCardPadding">16,12,16,12</Thickness>
    <Thickness x:Key="SettingsCardHeaderIconMargin">0,0,16,0</Thickness>
    <Thickness x:Key="SettingsExpanderItemPadding">16,12,16,12</Thickness>

    <!-- Style for settings section headers -->
    <Style
        x:Key="SettingsSectionHeaderTextBlockStyle"
        BasedOn="{StaticResource BodyStrongTextBlockStyle}"
        TargetType="TextBlock">
        <Style.Setters>
            <Setter Property="Margin" Value="1,30,0,6" />
        </Style.Setters>
    </Style>

    <DataTemplate x:Key="SettingItemTemplate" x:DataType="viewModels:SettingItemViewModel">
        <StackPanel Visibility="{x:Bind IsVisible, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"
                    Margin="0,0,0,2">
            <!-- Main settings card with overlays -->
            <Grid>
                <controls:SettingsCard
                    Header="{x:Bind Name}"
                    Description="{x:Bind Description}"
                    IsEnabled="{x:Bind EffectiveIsEnabled, Mode=OneWay}"
                    HeaderIcon="{x:Bind Converter={StaticResource SettingIconConverter}}"
                    Padding="16,12,16,12">
                    <commonControls:SettingsCardItem Setting="{x:Bind}" VerticalAlignment="Center"/>
                </controls:SettingsCard>

                <!-- Applying overlay with spinner -->
                <Border
                    Visibility="{x:Bind IsApplying, Mode=OneWay}"
                    Background="{ThemeResource SmokeFillColorDefaultBrush}"
                    CornerRadius="4">
                    <ProgressRing IsActive="{x:Bind IsApplying, Mode=OneWay}" Width="24" Height="24"/>
                </Border>

                <!-- Lock overlay covering entire SettingsCard -->
                <Grid Visibility="{x:Bind IsLocked, Mode=OneWay}">
                    <Grid.Transitions>
                        <TransitionCollection>
                            <AddDeleteThemeTransition/>
                        </TransitionCollection>
                    </Grid.Transitions>
                    <!-- Semi-transparent background layer -->
                    <Border
                        Background="{ThemeResource SmokeFillColorDefaultBrush}"
                        CornerRadius="4"/>
                    <!-- Button layer with full opacity -->
                    <Button
                        Command="{x:Bind UnlockCommand}"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Padding="12,8">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <Viewbox Width="16" Height="16">
                                <Path
                                    Data="{StaticResource PrivacyIconPath}"
                                    Fill="#FFA500"
                                    Stretch="Uniform"/>
                            </Viewbox>
                            <TextBlock
                                Text="{x:Bind ClickToUnlockText}"
                                VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </Grid>
            </Grid>

            <!-- Status banner below the settings card (wrapper collapses when not shown) -->
            <Border Visibility="{x:Bind HasStatusBanner, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"
                    Margin="0,0,0,8">
                <InfoBar
                    IsOpen="{x:Bind HasStatusBanner, Mode=OneWay}"
                    Severity="{x:Bind StatusBannerSeverity, Mode=OneWay}"
                    Message="{x:Bind StatusBannerMessage, Mode=OneWay}"
                    IsClosable="False"
                    Margin="0,-1,0,0"
                    CornerRadius="0,0,4,4"/>
            </Border>

            <!-- Review mode diff banner (shown when a config diff exists for this setting) -->
            <Border Visibility="{x:Bind HasReviewDiff, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"
                    Margin="0,0,0,8">
                <InfoBar
                    IsOpen="{x:Bind HasReviewDiff, Mode=OneWay}"
                    Severity="Warning"
                    IsClosable="False"
                    Margin="0,-1,0,0"
                    CornerRadius="0,0,4,4">
                    <InfoBar.Content>
                        <Grid ColumnDefinitions="*,Auto,Auto" Margin="0,4,8,4">
                            <TextBlock
                                Grid.Column="0"
                                Text="{x:Bind ReviewDiffMessage, Mode=OneWay}"
                                TextWrapping="Wrap"
                                VerticalAlignment="Center"/>
                            <RadioButton
                                Grid.Column="1"
                                Content="Apply"
                                IsChecked="{x:Bind IsReviewApproved, Mode=TwoWay}"
                                Margin="8,0,0,0"
                                MinWidth="0"
                                VerticalAlignment="Center"/>
                            <RadioButton
                                Grid.Column="2"
                                Content="Don't apply"
                                IsChecked="{x:Bind IsReviewRejected, Mode=TwoWay}"
                                Margin="8,0,0,0"
                                MinWidth="0"
                                VerticalAlignment="Center"/>
                        </Grid>
                    </InfoBar.Content>
                </InfoBar>
            </Border>
        </StackPanel>
    </DataTemplate>

    <!-- ListViewItem container style for settings lists - removes default padding/margins -->
    <Style x:Key="SettingsListViewItemContainerStyle" TargetType="ListViewItem">
        <Setter Property="Padding" Value="0"/>
        <Setter Property="Margin" Value="0"/>
        <Setter Property="MinHeight" Value="0"/>
        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ListViewItem">
                    <ContentPresenter
                        Content="{TemplateBinding Content}"
                        ContentTemplate="{TemplateBinding ContentTemplate}"
                        HorizontalAlignment="Stretch"/>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- Group header template for settings lists -->
    <DataTemplate x:Key="SettingsGroupHeaderTemplate">
        <TextBlock
            Text="{Binding Key}"
            Visibility="{Binding HasVisibleItems, Converter={StaticResource BooleanToVisibilityConverter}}"
            Style="{StaticResource SettingsSectionHeaderTextBlockStyle}"/>
    </DataTemplate>

</ResourceDictionary>
