<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="Winhance.UI.Features.Common.Controls.SettingsListView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Winhance.UI.Features.Common.Controls">

    <!--
    KNOWN ISSUE: Visual "jump" on navigation when Windows animations are disabled

    When users disable "Animation effects" in Windows Settings > Accessibility > Visual effects,
    ListView items briefly show controls in their default state before bindings resolve,
    causing a visible "jump" as toggles animate to their correct positions.

    This is a known WinUI3 limitation related to how the framework handles Loaded events
    and binding timing when animations are disabled.
    See: https://github.com/microsoft/microsoft-ui-xaml/issues/8841

    FIX: Enable "Animation effects" in Windows Settings resolves this visual issue.
    -->

    <Grid>
        <!-- Loading State -->
        <ProgressRing
            IsActive="{x:Bind IsLoading, Mode=OneWay}"
            Visibility="{x:Bind IsLoading, Mode=OneWay}"
            Width="48"
            Height="48"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"/>

        <!-- Main Content -->
        <ScrollView Visibility="{x:Bind IsNotLoading, Mode=OneWay}">
            <!-- Wrap StackPanel in Grid to avoid visual glitches with MaxWidth -->
            <Grid>
                <StackPanel Spacing="{StaticResource SettingsCardSpacing}" MaxWidth="{StaticResource SettingsContentMaxWidth}" Margin="{StaticResource SettingsContentMargin}" HorizontalAlignment="Stretch" Padding="0,12,0,24">

                    <ListView
                        x:Name="SettingsListViewControl"
                        ItemTemplate="{StaticResource SettingItemTemplate}"
                        ItemContainerStyle="{StaticResource SettingsListViewItemContainerStyle}"
                        SelectionMode="None"
                        IsItemClickEnabled="False"
                        IsTabStop="False"
                        Background="Transparent"
                        Padding="0">

                        <ListView.KeyboardAccelerators>
                            <KeyboardAccelerator Key="D" Modifiers="Control"
                                                 Invoked="TechnicalDetailsAccelerator_Invoked"/>
                        </ListView.KeyboardAccelerators>

                        <ListView.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Spacing="{StaticResource SettingsCardSpacing}"/>
                            </ItemsPanelTemplate>
                        </ListView.ItemsPanel>

                        <ListView.GroupStyle>
                            <GroupStyle HeaderTemplate="{StaticResource SettingsGroupHeaderTemplate}"/>
                        </ListView.GroupStyle>
                    </ListView>

                    <!-- No Results Message -->
                    <TextBlock
                        Text="No settings match your search."
                        Style="{StaticResource BodyTextBlockStyle}"
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        HorizontalAlignment="Center"
                        Margin="0,40,0,0"
                        Visibility="{x:Bind HasNoSearchResults, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                </StackPanel>
            </Grid>
        </ScrollView>
    </Grid>
</UserControl>
