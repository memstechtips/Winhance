<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="Winhance.UI.Features.SoftwareApps.Views.WindowsAppsHelpContent"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:fluentIcons="using:FluentIcons.WinUI"
    mc:Ignorable="d">

    <StackPanel Spacing="16" MaxWidth="520">

        <!-- Status Legend -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Installed -->
            <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal" Spacing="8" Margin="0,0,0,6">
                <Ellipse Width="10" Height="10" VerticalAlignment="Center">
                    <Ellipse.Fill>
                        <SolidColorBrush Color="#00FF3C"/>
                    </Ellipse.Fill>
                </Ellipse>
                <TextBlock x:Name="InstalledText" VerticalAlignment="Center" Style="{StaticResource CaptionTextBlockStyle}"/>
            </StackPanel>

            <!-- Can be Reinstalled -->
            <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal" Spacing="8" Margin="0,0,0,6">
                <fluentIcons:SymbolIcon Symbol="Checkmark" IconVariant="Regular" FontSize="14" VerticalAlignment="Center">
                    <fluentIcons:SymbolIcon.Foreground>
                        <SolidColorBrush Color="#2196F3"/>
                    </fluentIcons:SymbolIcon.Foreground>
                </fluentIcons:SymbolIcon>
                <TextBlock x:Name="CanReinstallText" VerticalAlignment="Center" Style="{StaticResource CaptionTextBlockStyle}"/>
            </StackPanel>

            <!-- Not Installed -->
            <StackPanel Grid.Row="1" Grid.Column="0" Orientation="Horizontal" Spacing="8">
                <Ellipse Width="10" Height="10" VerticalAlignment="Center">
                    <Ellipse.Fill>
                        <SolidColorBrush Color="#9E9E9E"/>
                    </Ellipse.Fill>
                </Ellipse>
                <TextBlock x:Name="NotInstalledText" VerticalAlignment="Center" Style="{StaticResource CaptionTextBlockStyle}"/>
            </StackPanel>

            <!-- Cannot Reinstall -->
            <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Spacing="8">
                <fluentIcons:SymbolIcon Symbol="Dismiss" IconVariant="Regular" FontSize="14" VerticalAlignment="Center">
                    <fluentIcons:SymbolIcon.Foreground>
                        <SolidColorBrush Color="#F44336"/>
                    </fluentIcons:SymbolIcon.Foreground>
                </fluentIcons:SymbolIcon>
                <TextBlock x:Name="CannotReinstallText" VerticalAlignment="Center" Style="{StaticResource CaptionTextBlockStyle}"/>
            </StackPanel>
        </Grid>

        <Border Height="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}"/>

        <!-- Winhance Removal Status Section -->
        <StackPanel Spacing="8">
            <TextBlock x:Name="WinhanceStatusLabel" FontWeight="SemiBold" Style="{StaticResource BodyTextBlockStyle}"/>

            <ItemsControl x:Name="RemovalItemsControl" ItemsSource="{Binding RemovalStatusItems}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal" Spacing="8"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Button Command="{Binding RemoveCommand}"
                                IsEnabled="{Binding IsActive}"
                                ToolTipService.ToolTip="{Binding ScheduledTaskName}"
                                Loaded="RemovalButton_Loaded"
                                Padding="8"
                                Background="Transparent"
                                BorderThickness="1"
                                BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                CornerRadius="4"
                                MinWidth="0" MinHeight="0">
                            <Grid Width="20" Height="20">
                                <!-- Loading spinner -->
                                <ProgressRing IsActive="{Binding IsLoading}"
                                              Width="16" Height="16"
                                              Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                <!-- Icon (hidden when loading) -->
                                <Viewbox Width="20" Height="20" VerticalAlignment="Center" HorizontalAlignment="Center"
                                         Visibility="{Binding IsLoading, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                                    <PathIcon Foreground="{ThemeResource TextFillColorDisabledBrush}"/>
                                </Viewbox>
                            </Grid>
                        </Button>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </StackPanel>

        <Border Height="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}"/>

        <!-- Help Text -->
        <ScrollViewer MaxHeight="200" Padding="0,0,16,0" VerticalScrollBarVisibility="Auto">
            <TextBlock x:Name="HelpContentText"
                       TextWrapping="Wrap"
                       Style="{StaticResource CaptionTextBlockStyle}"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
        </ScrollViewer>

        <HyperlinkButton x:Name="LearnMoreLink" Padding="0" Margin="0,4,0,0"/>

    </StackPanel>
</UserControl>
